<!DOCTYPE html>
<html>

    <head>
        <meta charset="utf-8">
        <title>
            Camera API
        </title>

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    </head>

    <body>

        <button id="pick-image">Pick image</button>
        <div id="image-presenter"></div>


<!--         <form action="{% url take_photo %}" method="post" enctype="multipart/form-data">
            {{ form.as_p }}
            <input type="submit" value="Submit" />
        </form>
 -->
        <script>

        // WebActivities
        var pickImage = document.querySelector("#pick-image");
        if (pickImage) {
            pickImage.onclick = function () {
                 var pick = new MozActivity({
                     name: "pick",
                     data: {
                         type: ["image/png", "image/jpg", "image/jpeg"]
                      }
                 });

                pick.onsuccess = function () { 
                    var img = document.createElement("img");
                    img.src = window.URL.createObjectURL(this.result.blob);
                    var imagePresenter = document.querySelector("#image-presenter");
                    imagePresenter.appendChild(img);
                    imagePresenter.style.display = "block";

                    var url = '{% url take_photo %}';
                    var oMyForm = new FormData();
                    var oReq = new XMLHttpRequest();
                    oMyForm.append("file", this.result.blob);
                    oReq.open("POST", url);
                    oReq.send(oMyForm);



                };

                pick.onerror = function () { 
                    alert("Can't view the image!");
                };
            }
        }

        </script>

    </body>

</html>